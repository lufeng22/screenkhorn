%!TEX root = main.tex

\section{Analysis of marginal violations} % (fold)
\label{sec:analysis_of_marginal_violations}

% We derive in this section 
This section is devoted to establishing theoretical guarantees for the marginal violations of Screenkhorn. 
We first define the screened marginals $\mu^{\text{sc}} = B(u^{\text{sc}}, v^{\text{sc}}) \mathbf 1_m$ and $\nu^{\text{sc}} = B(u^{\text{sc}}, v^{\text{sc}})^\top \mathbf 1_n.$ 
Lemma~\ref{lemma_bounds_on_marginals} expresses a lower and upper bounds with respect to $\ell_1$-norm of $\mu^{\text{sc}}$and $\nu^{\text{sc}}$, while Proposition~\ref{proposition_error_in_marginals} gives an upper bound of marginal errors.

\begin{lemma}
\label{lemma_bounds_on_marginals}
Let $(u^{\text{sc}}, v^{\text{sc}})$ be an optimal solution of problem~\eqref{screen-sinkhorn_second_def}.
Then one has 
\begin{align*}
 \kappa \norm{\mu_{I_{\varepsilon,\kappa}}^{\text{}}}_1  + (n -n_b) &\bigg(\frac{mm_b\varepsilon^2 K_{\min}^2 \min_{j\in J_{\varepsilon, \kappa}} \nu_j}{ (n-n_b)m\kappa \varepsilon^2 K_{\min} + n_b\kappa^2 \max_{i\in I_{\varepsilon,\kappa}}\mu_i } + (m-m_b)\varepsilon^2K_{\min}\bigg)\\
 & \leq \norm{\mu^{\text{sc}}}_1\\
 & \qquad \qquad \leq \kappa \norm{\mu_{I_{\varepsilon,\kappa}}^{\text{}}}_1 + (n-n_b) \bigg(\frac{m_b\max_{j \in J_{\varepsilon,\kappa}} \nu_j}{n\kappa K_{\min}} + (m-m_b)\varepsilon
 ^2 \bigg)
\end{align*}
and 
\begin{align*}
\kappa^{-1} \norm{\nu_{J_{\varepsilon,\kappa}}^{\text{}}}_1 + (m -m_b) &\bigg(\frac{nn_b\varepsilon^2\kappa^2K_{\min}^2 \min_{i\in I_{\varepsilon, \kappa}} \mu_j}{ n(m-m_b)\varepsilon^2 \kappa K_{\min} + m_b\kappa \max_{j\in J_{\varepsilon,\kappa}}\nu_j } + (n-n_b)\varepsilon^2K_{\min}\bigg)\\
&\leq \norm{\nu^{\text{sc}}}_1\\
 & \qquad \quad \leq \kappa^{-1} \norm{\nu_{J_{\varepsilon,\kappa}}}_1 + (m-m_b)\bigg(\frac{n_b\kappa \max_{i\in I_{\varepsilon,\kappa}}\mu_i}{m K_{\min}} + (n-n_b)\varepsilon^2\bigg).
\end{align*}
\end{lemma}
\begin{proposition}
\label{proposition_error_in_marginals}
One has %\norm{\mu^{\text{sc}}}_1
\begin{align}
\label{maginal_mu}
{\norm{{\mu} -{\mu}^{\text{sc}}}^2_1}&\leq 7 n_bc_\kappa \max_{i} \mu_i + 7 (n-n_b)\bigg[\frac{m_b\max_{j}\nu_j}{n\kappa K_{\min}} + (m- m_b) \varepsilon^2 - \min_{i}\mu_i \nonumber\\
&\qquad \quad  + \max_{i} \mu_i\log\bigg(\frac{\kappa(n-n_b+ 1)\max_{i} \mu_i}{m_b K_{\min}\min_{j \in J_{\varepsilon,\kappa}}\nu_j} + \frac{n_b\kappa^2(\max_{i} \mu_i)^2}{mm_b\varepsilon^2K_{\min}^2\min_{j \in J_{\varepsilon,\kappa}}\nu_j}\bigg)\bigg]
\end{align}
and 
\begin{align}
\label{maginal_nu}
{\norm{{\nu} -{\nu}^{\text{sc}}}^2_1} &\leq 7 m_bc_{\kappa^{-1}}\max_{j} \nu_j + 7(m-m_b)\bigg[\frac{n_b\kappa\max_{i}\mu_i}{m K_{\min}} + (n- n_b) \varepsilon^2 - \min_{j}\nu_j\nonumber\\ 
&\qquad  + \max_{j} \nu_j\log\bigg(\frac{(m-m_b+ 1)\max_{j} \nu_j}{n_b \kappa K_{\min}\min_{i \in I_{\varepsilon,\kappa}}\mu_i} + \frac{m_b(\max_{j} \nu_j)^2}{nn_b\varepsilon^2\kappa^2K_{\min}^2\min_{i \in I_{\varepsilon,\kappa}}\mu_i}\bigg)\bigg],
\end{align}
where $c_z = z-\log(z)-1.$
\end{proposition}
Proofs of Lemma~\ref{lemma_bounds_on_marginals} and Proposition~\ref{proposition_error_in_marginals} are presented in supplementary material and they are based on the first order optimality conditions for problem~\eqref{screen-sinkhorn_second_def}. 
Furthermore, in proof of Proposition~\ref{proposition_error_in_marginals} we use a generalization of Pinsker inequality (see Lemma 1 in supplementary). 
Note that $c_\kappa$ and $c_{\kappa^{-1}}$ tend to zeros as $\kappa$ goes to one, which is the case when the number budget of points $(n_b,m_b)$ tends to the full one $(n,m)$.
Let $c_{\mu\nu} = \underline{\mu}\wedge \underline{\nu}$ where $\underline{\mu} = \min_{i\in I_{\varepsilon,\kappa}}\mu_i$ and $\underline{\nu} = \min_{j\in J_{\varepsilon,\kappa}}\nu_j$.
%Using the facts that $\varepsilon \leq (mnK_{\min}^2)^{-1/4}$ and $\kappa \leq \sqrt{m/(nc_{\mu\nu}K_{\min})}$, 
Then, we can get a closed forms of~\eqref{maginal_mu} and~\eqref{maginal_nu} depending on $n,m,K_{\min}$, the budgets $n_b,m_b,$ and $c_{\mu\nu}$ as follows:
\begin{align*}
{\norm{{\mu} -{\mu}^{\text{sc}}}^2_1} = \bigO\Bigg(n_bc_\kappa + (n- n_b) \bigg[\frac{m_b}{\sqrt{nmc_{\mu\nu}}K_{\min}^{3/2}} &+ \frac{m-m_b}{\sqrt{nmK_{\min}}}
 + \log\bigg(\frac{(n-n_b+1)\sqrt{m}}{m_b \sqrt{nc_{\mu\nu}}K_{\min}^{3/2}} 
\bigg)\bigg]\Bigg)
\end{align*}
and 
\begin{align*}
{\norm{{\nu} -{\nu}^{\text{sc}}}^2_1} = \bigO\Bigg(m_bc_{\kappa^{-1}} + (m- m_b) \bigg[\frac{n_b}{\sqrt{nmc_{\mu\nu}}K_{\min}^{3/2}} &+ \frac{n-n_b}{\sqrt{nmK_{\min}}}
 + \log\bigg(\frac{(m-m_b+1)\sqrt{n}}{n_b \sqrt{mc_{\mu\nu}}K_{\min}^{3/2}} 
\bigg)\bigg]\Bigg)
\end{align*}

% section analysis_of_marginal_violations (end)
